<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- namespace: 해당 mapper파일의 고유한 별칭 -->
<mapper namespace="adminMapper">
	<resultMap type="Board" id="boardResult">
		<result column="board_no" property="boardNo" />
		<result column="user_no" property="userNo" />
		<result column="user_pwd" property="userPwd" />
		<result column="nickname" property="nickname" />
		<result column="gender" property="gender" />
		<result column="birth" property="birth" />
		<result column="address" property="address" />
		<result column="email" property="email" />
		<result column="phone" property="phone" />
		<result column="genre_like" property="genreLike" />
		<result column="grade" property="grade" />
		<result column="enroll_date" property="enrollDate" />
		<result column="withdrawal_date" property="withdrawalDate" />
		<result column="user_status" property="userStatus" />
		<result column="board_title" property="boardTitle" />
		<result column="board_write_date" property="boardWriteDate" />
		<result column="board_content" property="boardContent" />
		<result column="category_no" property="categoryNo"/>
		<result column="category_name" property="categoryName"/>
	</resultMap>
	<resultMap type="Category" id="categoryResult">
		<result column="category_no" property="categoryNo"/>
		<result column="ref_category_no" property="refCategoryNo"/>
		<result column="category_name" property="categoryName"/>
		<result column="category_level" property="categoryLevel"/>
	</resultMap>
	<resultMap type="Theater" id="theaterResult">
		<result column="theater_no" property="theaterNo"/>
		<result column="theater_name" property="theaterName"/>
		<result column="theater_row" property="theaterRow"/>
		<result column="theater_col" property="theaterCol"/>
		<result column="address" property="address"/>
		<result column="telno" property="telno"/>
	</resultMap>
	<resultMap type="ImpossibleSeat" id="impossibleSeatResult">
		<result column="impossible_seat_no" property="impossibleSeatNo"/>
		<result column="theater_no" property="theaterNo"/>
		<result column="impossible_seat_row" property="impossibleSeatRow"/>
		<result column="impossible_seat_col" property="impossibleSeatCol"/>
	</resultMap>

	<select id="selectFaqCategory" resultMap="categoryResult">
		SELECT
			category_no,
			ref_category_no,
			category_name,
			category_level
		FROM category
		WHERE ref_category_no = #{refCategoryNo}
	</select>
	
	<insert id="faqIncert">
		INSERT INTO board
		(
			user_no,
			board_code,
			board_title,
			board_content
		) VALUES (
			#{userNo},
			#{boardCode},
			#{boardTitle},
			#{boardContent}
		)
	</insert>
	
	<insert id="faqCategoryIncert">
		INSERT INTO board_category
		(
			board_no,
			category_no
		) values (
			CURRVAL('board_board_no_seq'::regclass),
			#{categoryNo}
		)
	</insert>
	
	<insert id="incertTheater">
		INSERT INTO theater
		(
			theater_name,
			theater_row,
			theater_col,
			address,
			telno
		) VALUES (
			#{theaterName},
			${theaterRow},
			${theaterCol},
			#{address},
			#{telno}
		)
	</insert>
	
	<insert id="incertImpossibleSeat">
		INSERT INTO impossible_seat
		(
			theater_no,
			impossible_seat_row,
			impossible_seat_col
		) VALUES (
			CURRVAL('theater_theater_no_seq'::regclass),
			${impossibleSeatRow},
			${impossibleSeatCol}
		)
	</insert>
	
	<select id="selectTheaterList" resultMap="theaterResult">
		SELECT
			theater_no,
			theater_name,
			theater_row,
			theater_col
		FROM theater
		WHERE theater_name LIKE '%${keyword}%'
		LIMIT 5
	</select>
	
	<insert id="insertConcert">
		INSERT INTO concert
		( 
			theater_no,
			concert_title,
			concert_plot,
			concert_runtime,
			concert_members,
			concert_production,
			age_limit
		) VALUES (
			#{theaterNo},
			#{concertTitle},
			#{concertPlot},
			#{concertRuntime},
			#{concertMembers},
			#{concertProduction},
			#{ageLimit}
		)
	</insert>
	
	<insert id="insertConcertCategory">
		INSERT INTO concert_category
		(
			concert_no,
			category_no
		) VALUES (
			CURRVAL('concert_concert_no_seq'::regclass),
			#{categoryNo}
		)
	</insert>
	
	<insert id="insertConcertAttachment">
		INSERT INTO concert_attachment
		(
			concert_no,
			origin_name,
			change_name,
			file_path
		) VALUES (
			CURRVAL('concert_concert_no_seq'::regclass),
			#{originName},
			#{changeName},
			#{filePath}
		)
	</insert>
	
	<insert id="insertScheduleList">
		INSERT INTO concert_schedule
		(
			concert_no,
			schedule,
			start_date,
			end_date
		) VALUES (
			CURRVAL('concert_concert_no_seq'::regclass),
			#{schedule},
			#{startDate},
			#{endDate}
		)
	</insert>
	
	<insert id="insertSeatList">
		INSERT INTO seat
		(
			concert_no,
			grade,
			price,
			concert_date,
			seat_start_row,
			seat_end_row,
			seat_start_col,
			seat_end_col
		) VALUES (
			CURRVAL('concert_concert_no_seq'::regclass),
			#{grade},
			#{price},
			#{concertDate},
			#{seatStartRow},
			#{seatEndRow},
			#{seatStartCol},
			#{seatEndCol}
		)
	</insert>
	
	<select id="selectNotice" resultMap="boardResult">
		SELECT
			b.board_no,
			u.user_no,
			u.nickname,
			b.board_level,
			b.board_write_date,
			b.board_title,
			b.board_content,
			b.board_count,
			bc.category_no,
			c.category_name
		FROM board b
		JOIN staez_user u on (b.user_no = u.user_no)
		JOIN board_category bc on (b.board_no = bc.board_no)
		JOIN category c on (bc.category_no = c.category_no)
		WHERE b.board_status = 'Y'
		and b.board_code = 1
		ORDER BY b.board_no DESC
	</select>
	
	<select id="selectNoticeByCategory" resultMap="boardResult">
		SELECT
			b.board_no,
			u.user_no,
			u.nickname,
			b.board_level,
			b.board_write_date,
			b.board_title,
			b.board_content,
			b.board_count,
			bc.category_no,
			c.category_name
		FROM board b
		JOIN staez_user u on (b.user_no = u.user_no)
		JOIN board_category bc on (b.board_no = bc.board_no)
		JOIN category c on (bc.category_no = c.category_no)
		WHERE b.board_status = 'Y'
		and b.board_code = 1
		and c.category_no = ${categoryNo}
		ORDER BY b.board_no DESC
	</select>
	
	<insert id="insertNotice">
		INSERT INTO board
		(
			user_no,
			board_title,
			board_content,
			board_code
		) VALUES (
			#{userNo},
			#{boardTitle},
			#{boardContent},
			1
		)
	</insert>
	
	<insert id="insertNoticeCategory">
		INSERT INTO board_category
		(
			board_no,
			category_no
		) VALUES (
			CURRVAL('board_board_no_seq'::regclass),
			#{categoryNo}
		)
	</insert>
	
	<select id="noticeDetail" resultMap="boardResult">
		SELECT
			b.board_no,
			u.user_no,
			u.nickname,
			b.board_write_date,
			b.board_title,
			b.board_content,
			b.board_count,
			bc.category_no,
			c.category_name
		FROM board b
		JOIN staez_user u on (b.user_no = u.user_no)
		JOIN board_category bc on (b.board_no = bc.board_no)
		JOIN category c on (bc.category_no = c.category_no)
		WHERE b.board_no = ${boardNo}
	</select>
</mapper>

